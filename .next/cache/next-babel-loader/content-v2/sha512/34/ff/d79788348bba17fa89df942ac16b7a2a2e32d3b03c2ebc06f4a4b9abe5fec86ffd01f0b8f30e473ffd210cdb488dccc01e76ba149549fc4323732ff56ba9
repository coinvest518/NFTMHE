{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\n\n/* eslint-disable jsx-a11y/no-static-element-interactions */\nimport React, { useState, useEffect } from 'react';\nimport style from './ModalMint.module.scss';\nimport Close from 'components/assets/close';\nimport randomstring from 'randomstring';\nimport QRCode from 'components/base/QRCode';\nimport CheckMark from 'components/assets/checkmark';\nimport { useRouter } from 'next/router';\nimport { connect as connectIo } from 'utils/socket/socket.helper';\n\nvar ModalMint = function ModalMint(_ref) {\n  var setModalCreate = _ref.setModalCreate,\n      error = _ref.error,\n      setError = _ref.setError,\n      output = _ref.output,\n      QRData = _ref.QRData;\n\n  var _useState = useState(randomstring.generate()),\n      session = _useState[0];\n\n  var _useState2 = useState(false),\n      showQR = _useState2[0],\n      setShowQR = _useState2[1];\n\n  var _useState3 = useState(false),\n      isRN = _useState3[0],\n      setIsRN = _useState3[1];\n\n  var _useState4 = useState(null),\n      mintReponse = _useState4[0],\n      setMintResponse = _useState4[1];\n\n  var router = useRouter();\n  var walletId = QRData.walletId,\n      price = QRData.price,\n      links = QRData.links,\n      fileHash = QRData.fileHash;\n\n  var handleMintSocketProcess = function handleMintSocketProcess() {\n    console.log('socket connect on session', session);\n    var socket = connectIo(\"/socket/createNft\", {\n      session: session\n    }, undefined, 5 * 60 * 1000);\n    socket.on('CONNECTION_SUCCESS', function () {\n      if (isRN) {\n        var data = {\n          session: session,\n          walletId: walletId,\n          price: price,\n          links: links,\n          fileHash: fileHash\n        };\n        setTimeout(function () {\n          window.ReactNativeWebView.postMessage(JSON.stringify({\n            action: 'MINT',\n            data: data\n          }));\n        }, 2000);\n      } else {\n        setShowQR(true);\n      }\n    });\n    socket.on('connect_error', function (e) {\n      console.error('connection error socket', e);\n      setModalCreate(false);\n    });\n    socket.on('CONNECTION_FAILURE', function (data) {\n      return setError(data.msg);\n    });\n    socket.on('MINTING_NFT', function (_ref2) {\n      var success = _ref2.success;\n      console.log('MINTING_NFT:' + success);\n      socket.emit('MINTING_NFT_RECEIVED');\n      socket.close();\n      setMintResponse(success);\n      setTimeout(function () {\n        setModalCreate(false);\n        router.back();\n      }, 4000);\n    });\n    socket.on('disconnect', function () {\n      setModalCreate(false);\n    });\n    return function () {\n      if (socket && socket.connected) {\n        socket.close();\n      }\n    };\n  };\n\n  useEffect(function () {\n    setIsRN(window.isRNApp);\n  }, []);\n  useEffect(function () {\n    console.log('showQR', showQR);\n\n    if (showQR) {\n      handleMintSocketProcess();\n    }\n  }, [showQR]);\n  useEffect(function () {\n    if (output.length > 0) {\n      setShowQR(true);\n    }\n  }, [output]);\n\n  function returnState() {\n    if (output.length > 0) {\n      return /*#__PURE__*/_jsxs(_Fragment, {\n        children: [mintReponse === null && /*#__PURE__*/_jsxs(_Fragment, {\n          children: [/*#__PURE__*/_jsx(\"div\", {\n            className: style.Text,\n            children: \"Flash this QR Code on your mobile wallet app to mint your NFT on the Ternoa blockchain.\"\n          }), showQR && /*#__PURE__*/_jsx(\"div\", {\n            className: style.QR,\n            children: /*#__PURE__*/_jsx(QRCode, {\n              data: {\n                session: session,\n                walletId: walletId,\n                price: price,\n                links: links,\n                fileHash: fileHash\n              },\n              action: 'MINT'\n            })\n          }), !showQR && /*#__PURE__*/_jsxs(\"div\", {\n            className: style.Loading,\n            children: [/*#__PURE__*/_jsx(\"span\", {\n              className: style.Dot\n            }), /*#__PURE__*/_jsx(\"span\", {\n              className: style.Dot\n            }), /*#__PURE__*/_jsx(\"span\", {\n              className: style.Dot\n            })]\n          })]\n        }), mintReponse === true && /*#__PURE__*/_jsx(\"div\", {\n          className: style.Text,\n          children: \"Mint was added to the blockchain.\"\n        }), mintReponse === false && /*#__PURE__*/_jsx(\"div\", {\n          className: style.Text,\n          children: \"Mint was not added to the blockchain.\"\n        })]\n      });\n    } else {\n      return /*#__PURE__*/_jsxs(_Fragment, {\n        children: [/*#__PURE__*/_jsx(\"div\", {\n          className: style.Text,\n          children: \"Please wait while we are processing your files.\"\n        }), /*#__PURE__*/_jsx(\"div\", {\n          className: style.Status,\n          children: output.length > 0 ? /*#__PURE__*/_jsxs(\"div\", {\n            className: style.Step,\n            children: [\"Upload completed \", /*#__PURE__*/_jsx(CheckMark, {\n              className: style.CheckMark\n            })]\n          }) : /*#__PURE__*/_jsxs(\"div\", {\n            className: style.Waiting,\n            children: [/*#__PURE__*/_jsx(\"div\", {\n              className: style.Mess,\n              children: \"Minting NFT...\"\n            }), /*#__PURE__*/_jsxs(\"div\", {\n              className: style.Loading,\n              children: [/*#__PURE__*/_jsx(\"span\", {\n                className: style.Dot\n              }), /*#__PURE__*/_jsx(\"span\", {\n                className: style.Dot\n              }), /*#__PURE__*/_jsx(\"span\", {\n                className: style.Dot\n              })]\n            })]\n          })\n        })]\n      });\n    }\n  }\n\n  return /*#__PURE__*/_jsx(\"div\", {\n    id: \"createModal\",\n    className: style.Background,\n    children: /*#__PURE__*/_jsxs(\"div\", {\n      className: style.Container,\n      children: [/*#__PURE__*/_jsx(Close, {\n        onClick: function onClick() {\n          return setModalCreate(false);\n        },\n        className: style.Close\n      }), /*#__PURE__*/_jsx(\"div\", {\n        className: style.Title,\n        children: \"Create NFT\"\n      }), error ? /*#__PURE__*/_jsx(\"div\", {\n        className: style.Error,\n        children: error\n      }) : returnState()]\n    })\n  });\n};\n\nexport default ModalMint;","map":null,"metadata":{},"sourceType":"module"}